{#  -*- coding: utf-8 -*- #}
{% import 'index_helper.tmpl' as helper with context %}
{% import 'math_helper.tmpl' as math with context %}
{% import 'comments_helper.tmpl' as comments with context %}
{% import 'pagination_helper.tmpl' as pagination with context %}
{% import 'feeds_translations_helper.tmpl' as feeds_translations with context %}
{% extends 'base.tmpl' %}

{% block extra_head %}
    {{ super() }}
    {% if posts and (permalink == '/' or permalink == '/' + index_file) %}
        <link rel="prefetch" href="{{ posts[0].permalink() }}" type="text/html">
    {% endif %}
    {{ math.math_styles_ifposts(posts) }}
{% endblock %}


{% block content %}

    {# From tagindex.tmpl #}
    {% block content_header %}
        {{ feeds_translations.translation_link() }}
    {% endblock %}

    {# Displays FRONT_INDEX_HEADER from conf.py #}
    {% if 'main_index' in pagekind %}
        {{ front_index_header }}
    {% endif %}

    {% if page_links %}
        {{ pagination.page_navigation(current_page, page_links, prevlink, nextlink, prev_next_links_reversed) }}
    {% endif %}


    <!-- POST INDEX -->
    <div class="postindex">

    {% for post in posts %}

        <article class="post-teaser clearfix">
            
            <!-- Teaser Preview Image -->
            <div class="teaser-image">
                <a href="{{ post.permalink() }}" class="u-url">
                    {% if post.previewimage %}
                        <img src="{{ post.permalink() }}{{ post.previewimage }}">
                    {% else %}
                        <img src="/assets/img/preview-img/nikola-logo.png">
                    {% endif %}
                </a>
            </div>

            <!-- Teaser Content -->
            <div class="teaser-content">

                <!-- Title -->
                <h2 class="teaser-title">
                    <a href="{{ post.permalink() }}" class="u-url">{{ post.title()|e }}</a>
                </h2>
       
                <!-- Metadata -->
                <div class="metadata">

                    {# Author #}
                    <p class="byline author vcard">
                        <span class="byline-name fn" itemprop="author">
                        {% if author_pages_generated %}
                            <a href="{{ _link('author', post.author()) }}">{{ post.author()|e }}</a>
                        {% else %}
                            {{ post.author()|e }}
                        {% endif %}
                        </span>
                    </p>

                    {# Date #}
                    <p class="dateline">
                        <time class="published dt-published" datetime="{{ post.formatted_date('webiso') }}" title="{{ post.formatted_date(date_format)|e }}">{{ post.formatted_date(date_format)|e }}</time>
                    </p>

                    {# Comments #}
                    {% if not post.meta('nocomments') and site_has_comments %}
                        <p class="commentline">{{ comments.comment_link(post.permalink(), post._base_path) }}
                    {% endif %}

                    {# Tags #}
                    <p class="tagline">
                        {% for tag in post.alltags|sort %}
                            {% if tag not in hidden_tags %}<span><a href="{{ _link('tag', tag) }}">{{ tag|e }}</a></span>{% endif %}
                        {% endfor %}
                    </p>
                </div>  

                <!-- Description -->
                <div class="post-description">
                    {{ post.description() }}
                </div>
            

                {# {% if index_teasers %}
                    <div class="p-summary entry-summary">
                    {{ post.text(teaser_only=True) }}
                {% else %}
                    <div class="e-content entry-content">
                    {{ post.text(teaser_only=False) }}
                {% endif %}
                    </div> #}

            </div>
        </article>

    {% endfor %}
    </div>

    <!-- POST INDEX PAGER -->
    {{ helper.html_pager() }}

    {# Helpers #}
    {{ comments.comment_link_script() }}
    {{ math.math_scripts_ifposts(posts) }}

{% endblock content %}

