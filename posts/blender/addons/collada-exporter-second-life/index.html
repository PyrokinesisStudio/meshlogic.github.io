<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Collada Exporter for Second Life - Blender Addon | MeshLogic</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="canonical" href="https://meshlogic.github.io/posts/blender/addons/collada-exporter-second-life/">
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true
        },
        displayAlign: 'center'
    });
</script><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Miki">
<link rel="prev" href="../toggle-object-wire/" title="Toggle Object Wire - Blender Addon" type="text/html">
<link rel="next" href="../../rendering/nodes-correct-hdri/" title="Correct Exposure of HDRI Environment Map in Blender" type="text/html">
<meta property="og:site_name" content="MeshLogic">
<meta property="og:title" content="Collada Exporter for Second Life - Blender Addon">
<meta property="og:url" content="https://meshlogic.github.io/posts/blender/addons/collada-exporter-second-life/">
<meta property="og:description" content="This python script is a replacement for the Blender's native Collada exporter made in C++. The main goal was to fix issues related to exporting static mesh objects including textures to the Second Lif">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-17T15:00:00+02:00">
<meta property="article:tag" content="blender-addons">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
</head>
<body>


<!-- BODY CONTAINER -->
<div class="container" id="body_container">

    <!-- HEADER -->
    <header id="body_header"><a href="../../../../" title="Home"><i>A personal blog on computer graphics, scientific computing, Blender, Jupyter and Second Life</i></a>
    </header><!-- NAVBAR --><nav class="navbar navbar-default navbar-static-top"><div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

                <a class="navbar-brand visible-xs" href="../../../../">
                <span id="blog-title">MeshLogic</span>
                </a>
        </div>
                
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false" role="navigation">
            <ul class="nav navbar-nav">
<li>
<a href="../../../../"><i class="fa fa-lg fa-home"></i>Â  Home</a>
                </li>
<li>
<a href="../../../../archive.html">Archive</a>
                </li>
<li>
<a href="../../../../categories/">Categories</a>
                </li>
<li>
<a href="../../../../gallery/">Gallery</a>
                </li>
<li>
<a href="../../../../pages/articles/">Articles</a>
                </li>
<li>
<a href="../../../../pages/blender-addons/">Blender Addons</a>
                </li>
<li>
<a href="../../../../pages/about/">About</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.rst" class="sourcelink">Source</a>
    </li>
                
            </ul>
</div>
    </nav><!-- BODY CONTENT !! --><div class="container" id="body_content" role="main">

        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><!--<h1 class="p-name entry-title" itemprop="headline name"><a href="/posts/blender/addons/collada-exporter-second-life/" class="u-url">Collada Exporter for Second Life - Blender Addon</a></h1> --><h1 class="p-name entry-title" itemprop="headline name">Collada Exporter for Second Life - Blender Addon</h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Miki
            </span></p>
            <p class="dateline"><time class="published dt-published" datetime="2017-05-17T15:00:00+02:00" itemprop="datePublished" title="2017-05-17">2017-05-17</time></p>
                <p class="commentline">            <a href="#disqus_thread" data-disqus-identifier="cache/posts/blender/addons/collada-exporter-second-life.html">Comments</a>


                    </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<!-- TEASER_END -->
<p>This python script is a replacement for the Blender's native Collada exporter made in C++. The main goal was to fix issues related to exporting static mesh objects including textures to the Second Life grid. Also, thanks to the python, this exporter can be easily modified/maintained without the need to go into Blender's source code and recompiling Blender.</p>
<div class="figure align-right">
<img alt="ui-panel.png" class="figure-round" src="ui-panel.png">
</div>
<div class="section" id="motivation">
<h2>Motivation</h2>
<p>Recently, I've noticed that the default Collada exporter in Blender (2.78) has some problems to export textured objects for usage in Second Life. Particularly, I've reported these two issues:</p>
<ul class="li-smallskip simple">
<li><a class="reference external" href="https://developer.blender.org/T51259">Collada exporter assigns the same texture to all objects when they share the same material</a></li>
<li><a class="reference external" href="https://developer.blender.org/T51288">Collada exporter does not assign any texture when object has multiple UV maps</a></li>
</ul>
<p>These issues prevent to quickly upload larger scenes (like a whole house) including all baked textures to SL and you need to apply textures by hand after upload, which is time wasting especially when you do many uploads to test your builds.</p>
<p>I wanted to try to fix these issues. But alas the default Collada exporter is made in C++ and I didn't want to recompile whole Blender. So, I decided to write my own Python based exporter that would work as an addon.</p>
</div>
<div class="section" id="features">
<h2>Features</h2>
<ul class="li-smallskip simple">
<li>Export static mesh objects to Collada (.dae), including images assigned to the active UV layer.</li>
<li>Export normals according the Auto-Smooth mesh option. Works also with face weighted normals.</li>
<li>Tested with Firestorm Viewer for Second Life.</li>
<li>Requires python collada module <a class="reference external" href="https://github.com/pycollada/pycollada">https://github.com/pycollada/pycollada</a>. Pycollada is not a part of official Blender, so must be installed into Blender's folder (eg. Blender/2.78/scripts/modules)</li>
</ul>
</div>
<div class="section" id="changelog">
<h2>ChangeLog</h2>
<dl class="docutils">
<dt>Version 0.3 (30.11.2017)</dt>
<dd><ul class="first last simple">
<li>Remove model tags (PHY, LOD1, LOD2, etc) from material id names</li>
<li>Export normals according the Auto-Smooth mesh option</li>
<li>Added more shading options</li>
</ul></dd>
<dt>Version 0.2 (17.05.2017)</dt>
<dd><ul class="first last simple">
<li>Objects (geometry nodes) are sorted by name now</li>
</ul></dd>
<dt>Version 0.1 (12.05.2017)</dt>
<dd><ul class="first last simple">
<li>Initial release</li>
</ul></dd>
</dl>
</div>
<div class="section" id="download">
<h2>Download</h2>
<!-- - `From my GitHub <https://github.com/meshlogic/blender-addons/tree/master/collada-exporter-sl>`_ -->
<p><a class="reference external" href="../../../../listings/blender-addons/collada-exporter-sl/0.3/ColladaExporterSL.py.html">blender-addons/collada-exporter-sl/0.3/ColladaExporterSL.py</a>  <a class="reference external" href="../../../../listings/blender-addons/collada-exporter-sl/0.3/ColladaExporterSL.py">(Source)</a></p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-1">  1</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-2">  2</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-3">  3</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-4">  4</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-5">  5</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-6">  6</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-7">  7</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-8">  8</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-9">  9</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-10"> 10</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-11"> 11</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-12"> 12</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-13"> 13</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-14"> 14</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-15"> 15</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-16"> 16</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-17"> 17</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-18"> 18</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-19"> 19</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-20"> 20</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-21"> 21</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-22"> 22</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-23"> 23</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-24"> 24</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-25"> 25</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-26"> 26</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-27"> 27</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-28"> 28</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-29"> 29</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-30"> 30</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-31"> 31</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-32"> 32</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-33"> 33</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-34"> 34</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-35"> 35</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-36"> 36</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-37"> 37</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-38"> 38</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-39"> 39</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-40"> 40</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-41"> 41</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-42"> 42</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-43"> 43</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-44"> 44</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-45"> 45</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-46"> 46</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-47"> 47</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-48"> 48</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-49"> 49</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-50"> 50</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-51"> 51</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-52"> 52</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-53"> 53</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-54"> 54</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-55"> 55</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-56"> 56</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-57"> 57</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-58"> 58</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-59"> 59</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-60"> 60</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-61"> 61</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-62"> 62</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-63"> 63</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-64"> 64</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-65"> 65</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-66"> 66</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-67"> 67</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-68"> 68</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-69"> 69</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-70"> 70</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-71"> 71</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-72"> 72</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-73"> 73</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-74"> 74</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-75"> 75</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-76"> 76</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-77"> 77</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-78"> 78</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-79"> 79</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-80"> 80</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-81"> 81</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-82"> 82</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-83"> 83</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-84"> 84</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-85"> 85</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-86"> 86</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-87"> 87</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-88"> 88</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-89"> 89</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-90"> 90</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-91"> 91</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-92"> 92</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-93"> 93</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-94"> 94</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-95"> 95</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-96"> 96</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-97"> 97</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-98"> 98</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-99"> 99</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-100">100</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-101">101</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-102">102</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-103">103</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-104">104</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-105">105</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-106">106</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-107">107</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-108">108</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-109">109</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-110">110</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-111">111</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-112">112</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-113">113</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-114">114</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-115">115</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-116">116</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-117">117</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-118">118</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-119">119</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-120">120</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-121">121</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-122">122</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-123">123</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-124">124</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-125">125</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-126">126</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-127">127</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-128">128</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-129">129</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-130">130</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-131">131</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-132">132</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-133">133</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-134">134</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-135">135</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-136">136</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-137">137</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-138">138</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-139">139</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-140">140</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-141">141</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-142">142</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-143">143</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-144">144</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-145">145</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-146">146</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-147">147</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-148">148</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-149">149</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-150">150</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-151">151</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-152">152</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-153">153</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-154">154</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-155">155</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-156">156</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-157">157</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-158">158</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-159">159</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-160">160</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-161">161</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-162">162</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-163">163</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-164">164</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-165">165</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-166">166</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-167">167</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-168">168</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-169">169</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-170">170</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-171">171</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-172">172</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-173">173</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-174">174</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-175">175</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-176">176</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-177">177</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-178">178</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-179">179</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-180">180</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-181">181</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-182">182</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-183">183</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-184">184</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-185">185</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-186">186</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-187">187</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-188">188</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-189">189</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-190">190</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-191">191</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-192">192</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-193">193</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-194">194</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-195">195</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-196">196</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-197">197</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-198">198</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-199">199</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-200">200</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-201">201</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-202">202</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-203">203</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-204">204</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-205">205</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-206">206</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-207">207</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-208">208</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-209">209</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-210">210</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-211">211</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-212">212</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-213">213</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-214">214</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-215">215</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-216">216</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-217">217</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-218">218</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-219">219</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-220">220</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-221">221</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-222">222</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-223">223</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-224">224</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-225">225</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-226">226</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-227">227</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-228">228</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-229">229</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-230">230</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-231">231</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-232">232</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-233">233</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-234">234</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-235">235</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-236">236</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-237">237</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-238">238</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-239">239</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-240">240</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-241">241</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-242">242</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-243">243</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-244">244</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-245">245</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-246">246</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-247">247</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-248">248</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-249">249</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-250">250</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-251">251</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-252">252</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-253">253</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-254">254</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-255">255</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-256">256</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-257">257</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-258">258</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-259">259</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-260">260</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-261">261</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-262">262</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-263">263</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-264">264</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-265">265</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-266">266</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-267">267</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-268">268</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-269">269</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-270">270</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-271">271</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-272">272</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-273">273</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-274">274</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-275">275</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-276">276</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-277">277</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-278">278</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-279">279</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-280">280</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-281">281</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-282">282</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-283">283</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-284">284</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-285">285</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-286">286</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-287">287</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-288">288</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-289">289</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-290">290</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-291">291</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-292">292</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-293">293</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-294">294</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-295">295</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-296">296</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-297">297</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-298">298</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-299">299</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-300">300</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-301">301</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-302">302</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-303">303</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-304">304</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-305">305</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-306">306</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-307">307</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-308">308</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-309">309</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-310">310</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-311">311</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-312">312</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-313">313</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-314">314</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-315">315</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-316">316</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-317">317</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-318">318</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-319">319</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-320">320</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-321">321</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-322">322</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-323">323</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-324">324</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-325">325</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-326">326</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-327">327</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-328">328</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-329">329</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-330">330</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-331">331</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-332">332</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-333">333</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-334">334</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-335">335</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-336">336</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-337">337</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-338">338</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-339">339</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-340">340</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-341">341</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-342">342</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-343">343</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-344">344</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-345">345</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-346">346</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-347">347</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-348">348</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-349">349</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-350">350</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-351">351</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-352">352</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-353">353</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-354">354</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-355">355</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-356">356</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-357">357</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-358">358</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-359">359</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-360">360</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-361">361</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-362">362</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-363">363</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-364">364</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-365">365</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-366">366</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-367">367</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-368">368</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-369">369</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-370">370</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-371">371</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-372">372</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-373">373</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-374">374</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-375">375</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-376">376</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-377">377</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-378">378</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-379">379</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-380">380</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-381">381</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-382">382</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-383">383</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-384">384</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-385">385</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-386">386</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-387">387</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-388">388</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-389">389</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-390">390</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-391">391</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-392">392</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-393">393</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-394">394</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-395">395</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-396">396</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-397">397</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-398">398</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-399">399</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-400">400</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-401">401</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-402">402</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-403">403</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-404">404</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-405">405</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-406">406</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-407">407</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-408">408</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-409">409</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-410">410</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-411">411</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-412">412</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-413">413</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-414">414</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-415">415</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-416">416</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-417">417</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-418">418</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-419">419</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-420">420</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-421">421</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-422">422</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-423">423</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-424">424</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-425">425</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-426">426</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-427">427</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-428">428</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-429">429</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-430">430</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-431">431</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-432">432</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-433">433</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-434">434</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-435">435</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-436">436</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-437">437</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-438">438</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-439">439</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-440">440</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-441">441</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-442">442</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-443">443</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-444">444</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-445">445</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-446">446</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-447">447</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-448">448</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-449">449</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-450">450</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-451">451</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-452">452</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-453">453</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-454">454</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-455">455</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-456">456</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-457">457</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-458">458</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-459">459</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-460">460</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-461">461</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-462">462</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-463">463</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-464">464</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-465">465</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-466">466</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-467">467</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-468">468</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-469">469</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-470">470</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-471">471</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-472">472</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-473">473</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-474">474</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-475">475</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-476">476</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-477">477</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-478">478</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-479">479</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-480">480</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-481">481</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-482">482</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-483">483</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-484">484</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-485">485</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-486">486</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-487">487</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-488">488</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-489">489</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-490">490</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-491">491</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-492">492</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-493">493</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-494">494</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-495">495</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-496">496</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-497">497</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-498">498</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-499">499</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-500">500</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-501">501</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-502">502</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-503">503</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-504">504</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-505">505</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-506">506</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-507">507</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-508">508</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-509">509</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-510">510</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-511">511</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-512">512</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-513">513</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-514">514</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-515">515</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-516">516</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-517">517</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-518">518</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-519">519</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-520">520</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-521">521</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-522">522</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-523">523</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-524">524</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-525">525</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-526">526</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-527">527</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-528">528</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-529">529</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-530">530</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-531">531</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-532">532</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-533">533</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-534">534</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-535">535</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-536">536</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-537">537</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-538">538</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-539">539</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-540">540</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-541">541</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-542">542</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-543">543</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-544">544</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-545">545</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-546">546</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-547">547</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-548">548</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-549">549</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-550">550</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-551">551</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-552">552</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-553">553</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-554">554</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-555">555</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-556">556</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-557">557</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-558">558</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-559">559</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-560">560</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-561">561</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-562">562</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-563">563</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-564">564</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-565">565</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-566">566</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-567">567</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-568">568</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-569">569</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-570">570</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-571">571</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-572">572</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-573">573</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-574">574</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-575">575</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-576">576</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-577">577</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-578">578</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-579">579</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-580">580</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-581">581</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-582">582</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-583">583</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-584">584</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-585">585</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-586">586</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-587">587</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-588">588</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-589">589</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-590">590</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-591">591</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-592">592</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-593">593</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-594">594</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-595">595</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-596">596</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-597">597</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-598">598</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-599">599</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-600">600</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-601">601</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-602">602</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-603">603</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-604">604</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-605">605</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-606">606</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-607">607</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-608">608</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-609">609</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-610">610</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-611">611</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-612">612</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-613">613</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-614">614</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-615">615</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-616">616</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-617">617</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-618">618</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-619">619</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-620">620</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-621">621</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-622">622</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-623">623</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-624">624</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-625">625</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-626">626</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-627">627</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-628">628</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-629">629</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-630">630</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-631">631</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-632">632</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-633">633</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-634">634</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-635">635</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-636">636</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-637">637</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-638">638</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-639">639</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-640">640</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-641">641</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-642">642</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-643">643</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-644">644</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-645">645</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-646">646</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-647">647</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-648">648</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-649">649</a>
<a href="#rest_code_257a9b819ea843148fc51ef6a7a931a6-650">650</a></pre></div></td>
<td class="code"><pre class="code python"><a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-1"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-2"></a><span class="c1">#                Collada Exporter for Second Life - Blender Addon</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-3"></a><span class="c1">#</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-4"></a><span class="c1"># - Export static mesh objects to Collada (.dae), including textures assigned to</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-5"></a><span class="c1">#   the active UV layer. Tested with Firestorm Viewer for Second Life.</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-6"></a><span class="c1">#</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-7"></a><span class="c1"># - Requires python collada module https://github.com/pycollada/pycollada</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-8"></a><span class="c1"># - Pycollada is not part of official Blender, so must be installed into</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-9"></a><span class="c1">#   Blender's folder (eg. Blender/2.78/scripts/modules)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-10"></a><span class="c1">#</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-11"></a><span class="c1">#   Version: 0.3</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-12"></a><span class="c1">#   Revised: 30.11.2017</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-13"></a><span class="c1">#   Author: Miki (meshlogic)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-14"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-15"></a><span class="c1"># v0.3</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-16"></a><span class="c1">#   - Remove model tags (PHY, LOD1, LOD2, etc) from material id names</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-17"></a><span class="c1">#   - Export normals according the Auto-Smooth mesh option</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-18"></a><span class="c1">#   - Added more shading options</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-19"></a><span class="c1"># v0.2</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-20"></a><span class="c1">#   - Objects (geometry nodes) are sorted by name now</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-21"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-22"></a><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-23"></a>    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Collada Exporter SL"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-24"></a>    <span class="s2">"author"</span><span class="p">:</span> <span class="s2">"Miki (meshlogic)"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-25"></a>    <span class="s2">"category"</span><span class="p">:</span> <span class="s2">"Import-Export"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-26"></a>    <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Export static mesh objects to Collada (.dae), incl. textures assigned to the active UV layer."</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-27"></a>    <span class="s2">"location"</span><span class="p">:</span> <span class="s2">"File &gt; Export"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-28"></a>    <span class="s2">"version"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-29"></a>    <span class="s2">"blender"</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-30"></a><span class="p">}</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-31"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-32"></a><span class="kn">import</span> <span class="nn">bpy</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-33"></a><span class="kn">import</span> <span class="nn">bpy_extras.io_utils</span> <span class="kn">as</span> <span class="nn">io_utils</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-34"></a><span class="kn">import</span> <span class="nn">bmesh</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-35"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-36"></a><span class="kn">import</span> <span class="nn">re</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-37"></a><span class="kn">import</span> <span class="nn">time</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-38"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-39"></a><span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-40"></a><span class="kn">from</span> <span class="nn">bpy.props</span> <span class="kn">import</span> <span class="o">*</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-41"></a><span class="kn">from</span> <span class="nn">bpy.types</span> <span class="kn">import</span> <span class="n">Menu</span><span class="p">,</span> <span class="n">Operator</span><span class="p">,</span> <span class="n">Panel</span><span class="p">,</span> <span class="n">UIList</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-42"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-43"></a><span class="c1"># Import pycollada module</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-44"></a><span class="kn">from</span> <span class="nn">collada</span> <span class="kn">import</span> <span class="o">*</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-45"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-46"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-47"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-48"></a><span class="c1"># ColladaExporter OPERATOR</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-49"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-50"></a><span class="k">class</span> <span class="nc">ColladaExporter_OT</span><span class="p">(</span><span class="n">Operator</span><span class="p">,</span> <span class="n">io_utils</span><span class="o">.</span><span class="n">ExportHelper</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-51"></a>    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s2">"export_mesh.collada_sl"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-52"></a>    <span class="n">bl_label</span> <span class="o">=</span> <span class="s2">"Export Collada for SL"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-53"></a>    <span class="n">bl_description</span> <span class="o">=</span> <span class="s2">"Export the selected static mesh objects to Collada"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-54"></a>    <span class="n">bl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'PRESET'</span><span class="p">}</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-55"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-56"></a>    <span class="c1">#--- Collada file extension</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-57"></a>    <span class="n">filename_ext</span> <span class="o">=</span> <span class="s2">".dae"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-58"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-59"></a>    <span class="c1">#--- Mesh props</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-60"></a>    <span class="n">apply_modifiers</span> <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-61"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Apply Modifiers (View)"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-62"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"Apply modifiers (view mode)"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-63"></a>            <span class="n">default</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-64"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-65"></a>    <span class="n">triangulate</span> <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-66"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Triangulate"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-67"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"Triangulate the mesh faces for export"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-68"></a>            <span class="n">default</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-69"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-70"></a>    <span class="n">round_values</span> <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-71"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Round"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-72"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"Round values (vertex and normal coords) to the given decimal places"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-73"></a>            <span class="n">default</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-74"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-75"></a>    <span class="n">round_decimals</span> <span class="o">=</span> <span class="n">IntProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-76"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Decimals"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-77"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"Round values (vertex and normal coords) to the given decimal places"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-78"></a>            <span class="nb">min</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-79"></a>            <span class="n">default</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-80"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-81"></a>    <span class="c1">#--- Material props</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-82"></a>    <span class="n">diffuse_material</span> <span class="o">=</span> <span class="n">EnumProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-83"></a>        <span class="n">name</span> <span class="o">=</span> <span class="s2">"Diffuse Material"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-84"></a>        <span class="n">description</span> <span class="o">=</span> <span class="s2">"Diffuse material options"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-85"></a>        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-86"></a>            <span class="p">(</span><span class="s1">'UV_IMAGE'</span><span class="p">,</span> <span class="s2">"UV Textures"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-87"></a>            <span class="p">(</span><span class="s1">'MAT_COLOR'</span><span class="p">,</span> <span class="s2">"Material Colors"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-88"></a>            <span class="p">(</span><span class="s1">'CUSTOM_COLOR'</span><span class="p">,</span> <span class="s2">"Custom Color"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-89"></a>            <span class="p">(</span><span class="s1">'WHITE_COLOR'</span><span class="p">,</span> <span class="s2">"White"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-90"></a>        <span class="n">default</span> <span class="o">=</span> <span class="s1">'UV_IMAGE'</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-91"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-92"></a>    <span class="n">copy_images</span> <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-93"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Copy Textures"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-94"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"Copy textures to the export subfolder"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-95"></a>            <span class="n">default</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-96"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-97"></a>    <span class="n">use_relative_path</span> <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-98"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Relative Path"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-99"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"Use relative or absolute path for UV textures"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-100"></a>            <span class="n">default</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-101"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-102"></a>    <span class="c1">#--- Shading props</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-103"></a>    <span class="n">ambient</span> <span class="o">=</span> <span class="n">FloatProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-104"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Ambient"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-105"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"The amount of ambient light emitted from the surface of the object"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-106"></a>            <span class="n">subtype</span> <span class="o">=</span> <span class="s1">'NONE'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-107"></a>            <span class="nb">min</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-108"></a>            <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-109"></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-110"></a>            <span class="n">default</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-111"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-112"></a>    <span class="n">specular</span> <span class="o">=</span> <span class="n">FloatProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-113"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Specular"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-114"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"The light specularly reflected from the surface of the object"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-115"></a>            <span class="n">subtype</span> <span class="o">=</span> <span class="s1">'NONE'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-116"></a>            <span class="nb">min</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-117"></a>            <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-118"></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-119"></a>            <span class="n">default</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-120"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-121"></a>    <span class="n">shininess</span> <span class="o">=</span> <span class="n">FloatProperty</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-122"></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">"Shininess"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-123"></a>            <span class="n">description</span> <span class="o">=</span> <span class="s2">"The specularity or roughness of the specular reflection lobe"</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-124"></a>            <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-125"></a>            <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-126"></a>            <span class="n">step</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-127"></a>            <span class="n">default</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-128"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-129"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-130"></a>    <span class="c1">#--- Draw properties in export dialog</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-131"></a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-132"></a>        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-133"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-134"></a>        <span class="c1"># Diffuse Material options</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-135"></a>        <span class="n">box</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-136"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-137"></a>        <span class="n">row</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">"Diffuse Material:"</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">'TEXTURE'</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-138"></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-139"></a>        <span class="n">col</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"diffuse_material"</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-140"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-141"></a>        <span class="n">row</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"copy_images"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-142"></a>        <span class="n">row</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffuse_material</span> <span class="o">==</span> <span class="s1">'UV_IMAGE'</span> <span class="k">else</span> <span class="bp">False</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-143"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-144"></a>        <span class="c1"># Mesh options</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-145"></a>        <span class="n">box</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-146"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-147"></a>        <span class="n">row</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">"Mesh Options:"</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">'MESH_DATA'</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-148"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-149"></a>        <span class="n">row</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"apply_modifiers"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-150"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-151"></a>        <span class="n">row</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"triangulate"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-152"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-153"></a>        <span class="n">row</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"round_values"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-154"></a>        <span class="n">row</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"round_decimals"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-155"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-156"></a>        <span class="c1"># Shading options</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-157"></a>        <span class="n">box</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-158"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-159"></a>        <span class="n">row</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">"Shading Options:"</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">'MATSPHERE'</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-160"></a>        <span class="n">col</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-161"></a>        <span class="n">col</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"ambient"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-162"></a>        <span class="n">col</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"specular"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-163"></a>        <span class="n">col</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"shininess"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-164"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-165"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-166"></a>    <span class="c1">#--- Execute file export</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-167"></a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-168"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-169"></a>        <span class="c1"># Properties as a dictionary (incl. selected filepath from file dialog)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-170"></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_keywords</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-171"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-172"></a>        <span class="c1"># Init ColladaExporter object and execute export</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-173"></a>        <span class="n">collada_ex</span> <span class="o">=</span> <span class="n">ColladaExporter</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-174"></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">collada_ex</span><span class="o">.</span><span class="n">export</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-175"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-176"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">({</span><span class="s1">'INFO'</span><span class="p">},</span> <span class="n">info</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-177"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">'FINISHED'</span><span class="p">}</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-178"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-179"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-180"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-181"></a><span class="c1"># Misc Functions</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-182"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-183"></a><span class="c1"># Convert list/tuple items to string separated by sep</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-184"></a><span class="k">def</span> <span class="nf">list2str</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-185"></a>    <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-186"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-187"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-188"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-189"></a><span class="c1"># COLLADA EXPORTER CLASS</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-190"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-191"></a><span class="k">class</span> <span class="nc">ColladaExporter</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-192"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-193"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-194"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-195"></a>        <span class="c1"># Collada file export path</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-196"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">export_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"filepath"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-197"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">export_dir</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_path</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-198"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-199"></a>        <span class="c1"># Directory of this blend file</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-200"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-201"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-202"></a>        <span class="c1"># Export options</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-203"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">apply_modifiers</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"apply_modifiers"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-204"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">triangulate</span>       <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"triangulate"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-205"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">round_values</span>      <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"round_values"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-206"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">round_decimals</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"round_decimals"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-207"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-208"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">diffuse_material</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"diffuse_material"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-209"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">copy_images</span>       <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"copy_images"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-210"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_relative_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"use_relative_path"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-211"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-212"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ambient</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">"ambient"</span><span class="p">],)</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,)</span>      <span class="c1"># RGBA tuple</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-213"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">specular</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">"specular"</span><span class="p">],)</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,)</span>    <span class="c1"># RGBA tuple</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-214"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shininess</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"shininess"</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-215"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-216"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-217"></a>        <span class="c1"># Init Collada object for export</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-218"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span> <span class="o">=</span> <span class="n">Collada</span><span class="p">(</span><span class="n">validate_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-219"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene_nodes</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-220"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-221"></a>        <span class="c1"># Collada Asset Info</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-222"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">assetInfo</span><span class="o">.</span><span class="n">upaxis</span> <span class="o">=</span> <span class="s1">'Z_UP'</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-223"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">assetInfo</span><span class="o">.</span><span class="n">unitname</span> <span class="o">=</span> <span class="s2">"meter"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-224"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">assetInfo</span><span class="o">.</span><span class="n">unitmeter</span> <span class="o">=</span> <span class="mf">1.0</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-225"></a>        <span class="n">cont</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">Contributor</span><span class="p">(</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-226"></a>                <span class="s2">"Blender </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">list2str</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="s2">"."</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-227"></a>                <span class="s2">"Addon: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">bl_info</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span> <span class="n">list2str</span><span class="p">(</span><span class="n">bl_info</span><span class="p">[</span><span class="s2">"version"</span><span class="p">],</span> <span class="s2">"."</span><span class="p">)),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-228"></a>                <span class="s2">"Applly Modifiers: </span><span class="si">%s</span><span class="s2">, Triangulate: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangulate</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-229"></a>                <span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-230"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">assetInfo</span><span class="o">.</span><span class="n">contributors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-231"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-232"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-233"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-234"></a>    <span class="c1"># EXPORT</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-235"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-236"></a>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-237"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-238"></a>        <span class="c1">#--- Exit edit mode before exporting</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-239"></a>        <span class="k">if</span> <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="o">.</span><span class="n">poll</span><span class="p">():</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-240"></a>            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">mode_set</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">'OBJECT'</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-241"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-242"></a>        <span class="c1">#--- Measure script execution time</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-243"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-244"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-245"></a>        <span class="c1">#--- Export all selected objects (sorted by name)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-246"></a>        <span class="n">obj_list</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">selected_objects</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-247"></a>        <span class="n">obj_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span> <span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-248"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-249"></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">obj_list</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-250"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">export_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-251"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-252"></a>        <span class="c1">#--- Finish scene nodes</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-253"></a>        <span class="n">c_scene</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="s2">"Scene"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene_nodes</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-254"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">scenes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_scene</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-255"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">c_scene</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-256"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-257"></a>        <span class="c1">#--- Write Collada to file</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-258"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_path</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-259"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-260"></a>        <span class="c1">#--- Sort XML to fix upload to SL</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-261"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sortxml</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-262"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-263"></a>        <span class="c1">#--- Print and return info text</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-264"></a>        <span class="n">info</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%d</span><span class="s2"> objects saved to '</span><span class="si">%s</span><span class="s2">' (</span><span class="si">%.3f</span><span class="s2">sec)"</span> <span class="o">%</span>\
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-265"></a>                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">selected_objects</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_path</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-266"></a>        <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-267"></a>        <span class="k">return</span> <span class="n">info</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-268"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-269"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-270"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-271"></a>    <span class="c1"># IDNAME - Format strings for Collada ids (for material names, etc)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-272"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-273"></a>    <span class="k">def</span> <span class="nf">idname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-274"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-275"></a>        <span class="c1"># Removes any PHY, -LOD1, .Lod2, _lod3 etc</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-276"></a>        <span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">"[\-\.\_\s](lod|phy)\d*"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-277"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-278"></a>        <span class="c1"># Replace any dot in the string by "_"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-279"></a>        <span class="nb">str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">"\."</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-280"></a>        <span class="k">return</span> <span class="nb">str</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-281"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-282"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-283"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-284"></a>    <span class="c1"># ADD COLLADA IMAGE</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-285"></a>    <span class="c1"># - Add image to collada.images and return the CImage object</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-286"></a>    <span class="c1"># - Copy image to a subdir in the export dir if desired</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-287"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-288"></a>    <span class="k">def</span> <span class="nf">add_collada_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-289"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-290"></a>        <span class="c1">#--- Add image to collada.images</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-291"></a>        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-292"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-293"></a>            <span class="c1">#--- Copy image to a subdir in the export dir</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-294"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_images</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-295"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-296"></a>                <span class="c1"># Image source path and basename</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-297"></a>                <span class="n">img_sourcepath</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-298"></a>                <span class="n">img_basename</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">img_sourcepath</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-299"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-300"></a>                <span class="c1"># Copy image to subdir in export dir</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-301"></a>                <span class="n">export_filename</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">display_name_from_filepath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_path</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-302"></a>                <span class="c1">#subdir = export_filename + "_textures"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-303"></a>                <span class="n">subdir</span> <span class="o">=</span> <span class="s2">"textures"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-304"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-305"></a>                <span class="n">img_destpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_dir</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">img_basename</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-306"></a>                <span class="n">copy_set</span> <span class="o">=</span> <span class="p">{(</span><span class="n">img_sourcepath</span><span class="p">,</span> <span class="n">img_destpath</span><span class="p">)}</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-307"></a>                <span class="n">io_utils</span><span class="o">.</span><span class="n">path_reference_copy</span><span class="p">(</span><span class="n">copy_set</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-308"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-309"></a>                <span class="c1"># Relative path to the copied image</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-310"></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">io_utils</span><span class="o">.</span><span class="n">path_reference</span><span class="p">(</span><span class="n">img_destpath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_dir</span><span class="p">,</span> <span class="s1">'RELATIVE'</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-311"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-312"></a>            <span class="c1">#--- Reference image where it is</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-313"></a>            <span class="k">else</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-314"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_relative_path</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-315"></a>                    <span class="n">path_mode</span> <span class="o">=</span> <span class="s1">'RELATIVE'</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-316"></a>                <span class="k">else</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-317"></a>                    <span class="n">path_mode</span> <span class="o">=</span> <span class="s1">'ABSOLUTE'</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-318"></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">io_utils</span><span class="o">.</span><span class="n">path_reference</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_dir</span><span class="p">,</span> <span class="n">path_mode</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-319"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-320"></a>            <span class="c1">#--- Create and add CImage object</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-321"></a>            <span class="n">c_img</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">CImage</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-322"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_img</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-323"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-324"></a>        <span class="c1">#--- Image already added to collada.images</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-325"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-326"></a>            <span class="n">c_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-327"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-328"></a>        <span class="k">return</span> <span class="n">c_img</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-329"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-330"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-331"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-332"></a>    <span class="c1"># ADD COLLADA VOIDMAT</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-333"></a>    <span class="c1"># - Add this material in case of empty or no material slot</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-334"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-335"></a>    <span class="k">def</span> <span class="nf">add_collada_voidmat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-336"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-337"></a>        <span class="c1"># Collada material effect</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-338"></a>        <span class="n">c_effect</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Effect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span><span class="s2">"-effect"</span><span class="p">,</span> <span class="p">[],</span> <span class="s1">'phong'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-339"></a>                <span class="n">diffuse</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-340"></a>                <span class="n">ambient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ambient</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-341"></a>                <span class="n">specular</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specular</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-342"></a>                <span class="n">shininess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shininess</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-343"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">effects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_effect</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-344"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-345"></a>        <span class="c1"># Collada material</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-346"></a>        <span class="n">c_mat</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span><span class="s2">"-material"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">c_effect</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-347"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_mat</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-348"></a>        <span class="k">return</span> <span class="n">scene</span><span class="o">.</span><span class="n">MaterialNode</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span><span class="s2">"-material"</span><span class="p">,</span> <span class="n">c_mat</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-349"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-350"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-351"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-352"></a>    <span class="c1"># ADD COLLADA MATERIALS</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-353"></a>    <span class="c1"># - Add object materials to collada.materials and collada.effects</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-354"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-355"></a>    <span class="k">def</span> <span class="nf">add_collada_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">me</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-356"></a>        <span class="n">material_nodes</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-357"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-358"></a>        <span class="c1">#--- Get active uv map layer and texture</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-359"></a>        <span class="n">uvlayer</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">uv_layers</span><span class="o">.</span><span class="n">active</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-360"></a>        <span class="k">if</span> <span class="n">uvlayer</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-361"></a>            <span class="n">uvtex</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">uv_textures</span><span class="p">[</span><span class="n">uvlayer</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-362"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-363"></a>        <span class="c1"># [1] No material slot - Add void material</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-364"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">me</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-365"></a>            <span class="n">c_matnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_collada_voidmat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span><span class="s2">"_voidmat_0"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-366"></a>            <span class="n">material_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_matnode</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-367"></a>            <span class="k">return</span> <span class="n">material_nodes</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-368"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-369"></a>        <span class="c1"># [2] Go trough all slots in object materials</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-370"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">me</span><span class="o">.</span><span class="n">materials</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-371"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-372"></a>            <span class="c1">#--- Empty material slot - Add void material</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-373"></a>            <span class="k">if</span> <span class="n">mat</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-374"></a>                <span class="n">c_matnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_collada_voidmat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span><span class="s2">"_voidmat_"</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-375"></a>                <span class="n">material_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_matnode</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-376"></a>                <span class="k">continue</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-377"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-378"></a>            <span class="c1">#--- Look for uv image assigned to the given material and uv face</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-379"></a>            <span class="n">img</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-380"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffuse_material</span> <span class="o">==</span> <span class="s1">'UV_IMAGE'</span> <span class="ow">and</span> <span class="n">uvlayer</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-381"></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">me</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-382"></a>                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">material_index</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-383"></a>                        <span class="n">img</span> <span class="o">=</span> <span class="n">uvtex</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">image</span>     <span class="c1"># Get image assigned to the uv face</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-384"></a>                        <span class="n">c_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_collada_image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="c1"># Add image to collada images</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-385"></a>                        <span class="k">break</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-386"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-387"></a>            <span class="c1">#--- Include image map in the material effect</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-388"></a>            <span class="k">if</span> <span class="n">img</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-389"></a>                <span class="n">c_surface</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span><span class="s2">"-surface"</span><span class="p">,</span> <span class="n">c_img</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-390"></a>                <span class="n">c_sampler</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Sampler2D</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span><span class="s2">"-sampler"</span><span class="p">,</span> <span class="n">c_surface</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-391"></a>                <span class="n">params_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_sampler</span><span class="p">,</span> <span class="n">c_surface</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-392"></a>                <span class="n">inputs_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">uvlayer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">'TEXCOORD'</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-393"></a>                <span class="n">diffuse_map</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">c_sampler</span><span class="p">,</span> <span class="n">uvlayer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-394"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-395"></a>            <span class="c1">#--- No image map for the material effect - Use solid color instead!!</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-396"></a>            <span class="k">else</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-397"></a>                <span class="n">params_list</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-398"></a>                <span class="n">inputs_list</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-399"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-400"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffuse_material</span> <span class="o">==</span> <span class="s1">'MAT_COLOR'</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-401"></a>                    <span class="n">clr</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">diffuse_color</span><span class="p">[:]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-402"></a>                    <span class="n">diffuse_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">clr</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-403"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-404"></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffuse_material</span> <span class="o">==</span> <span class="s1">'CUSTOM_COLOR'</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-405"></a>                    <span class="n">diffuse_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_color</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-406"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-407"></a>                <span class="k">else</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-408"></a>                    <span class="n">diffuse_map</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># WHITE_COLOR</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-409"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-410"></a>            <span class="c1">#--- Add material effect to collada.effects</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-411"></a>            <span class="n">c_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span><span class="s2">"_"</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-412"></a>            <span class="n">c_effect</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Effect</span><span class="p">(</span><span class="n">c_name</span> <span class="o">+</span><span class="s2">"-effect"</span><span class="p">,</span> <span class="n">params_list</span><span class="p">,</span> <span class="s1">'phong'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-413"></a>                    <span class="n">diffuse</span> <span class="o">=</span> <span class="n">diffuse_map</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-414"></a>                    <span class="n">ambient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ambient</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-415"></a>                    <span class="n">specular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specular</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-416"></a>                    <span class="n">shininess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shininess</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-417"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">effects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_effect</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-418"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-419"></a>            <span class="c1">#--- Add material to collada.materials</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-420"></a>            <span class="n">c_mat</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">c_name</span> <span class="o">+</span><span class="s2">"-material"</span><span class="p">,</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">c_effect</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-421"></a>            <span class="n">c_matnode</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">MaterialNode</span><span class="p">(</span><span class="n">c_name</span> <span class="o">+</span><span class="s2">"-material"</span><span class="p">,</span> <span class="n">c_mat</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs_list</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-422"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_mat</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-423"></a>            <span class="n">material_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_matnode</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-424"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-425"></a>        <span class="c1">#--- Return scene.MaterialNode for each material</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-426"></a>        <span class="k">return</span> <span class="n">material_nodes</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-427"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-428"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-429"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-430"></a>    <span class="c1"># EXPORT OBJECT</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-431"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-432"></a>    <span class="k">def</span> <span class="nf">export_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-433"></a>        <span class="n">cs</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-434"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-435"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-436"></a>        <span class="c1"># Prepare object's mesh data (me)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-437"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-438"></a>        <span class="c1"># Create mesh for export &amp; apply modifiers if desired</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-439"></a>        <span class="n">me</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">,</span> <span class="s1">'PREVIEW'</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-440"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-441"></a>        <span class="c1"># Triangulate mesh if desired</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-442"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangulate</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-443"></a>            <span class="n">bm</span> <span class="o">=</span> <span class="n">bmesh</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-444"></a>            <span class="n">bm</span><span class="o">.</span><span class="n">from_mesh</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-445"></a>            <span class="n">bmesh</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">bm</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">bm</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-446"></a>            <span class="n">bm</span><span class="o">.</span><span class="n">to_mesh</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-447"></a>            <span class="n">bm</span><span class="o">.</span><span class="n">free</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-448"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-449"></a>        <span class="c1"># Calculate normals, necessary if auto-smooth option enabled</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-450"></a>        <span class="n">me</span><span class="o">.</span><span class="n">calc_normals</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-451"></a>        <span class="n">me</span><span class="o">.</span><span class="n">calc_normals_split</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-452"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-453"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-454"></a>        <span class="c1"># Material &amp; effect nodes for each object's material</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-455"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-456"></a>        <span class="n">material_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_collada_materials</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">me</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-457"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-458"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-459"></a>        <span class="c1"># Source list for vertex coords</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-460"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-461"></a>        <span class="n">verts_srcid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"-verts"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-462"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-463"></a>        <span class="n">verts_co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">co</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">me</span><span class="o">.</span><span class="n">vertices</span> <span class="k">for</span> <span class="n">co</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">co</span><span class="p">])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-464"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_values</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-465"></a>            <span class="n">verts_co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">verts_co</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_decimals</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-466"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-467"></a>        <span class="n">verts_src</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">FloatSource</span><span class="p">(</span><span class="n">verts_srcid</span><span class="p">,</span> <span class="n">verts_co</span><span class="p">,</span> <span class="p">(</span><span class="s1">'X'</span><span class="p">,</span> <span class="s1">'Y'</span><span class="p">,</span> <span class="s1">'Z'</span><span class="p">))</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-468"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-469"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-470"></a>        <span class="c1"># Source list for normals</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-471"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-472"></a>        <span class="n">normals_srcid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"-normals"</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-473"></a>        <span class="n">normals</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-474"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-475"></a>        <span class="c1"># - Good method to get normals, but it ignores Auto-Smooth option</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-476"></a>        <span class="c1">#for f in me.polygons:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-477"></a>        <span class="c1">#    # Smooth shaded face - use vertex normals</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-478"></a>        <span class="c1">#    if f.use_smooth:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-479"></a>        <span class="c1">#        for v_id in f.vertices:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-480"></a>        <span class="c1">#            v = me.vertices[v_id]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-481"></a>        <span class="c1">#            normals.extend(v.normal)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-482"></a>        <span class="c1">#    # Flat shaded face - use face normal for each polygon vert</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-483"></a>        <span class="c1">#    else:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-484"></a>        <span class="c1">#        for v_id in f.vertices:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-485"></a>        <span class="c1">#            normals.extend(f.normal)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-486"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-487"></a>        <span class="c1"># - Get normals from Loops - Loops define the boundary loop of a face &amp; store per-face-vertex data</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-488"></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">me</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-489"></a>            <span class="k">for</span> <span class="n">loop_id</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">loop_indices</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-490"></a>                <span class="n">normals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">me</span><span class="o">.</span><span class="n">loops</span><span class="p">[</span><span class="n">loop_id</span><span class="p">]</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-491"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-492"></a>        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">normals</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-493"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_values</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-494"></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_decimals</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-495"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-496"></a>        <span class="n">normals_src</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">FloatSource</span><span class="p">(</span><span class="n">normals_srcid</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="p">(</span><span class="s1">'X'</span><span class="p">,</span> <span class="s1">'Y'</span><span class="p">,</span> <span class="s1">'Z'</span><span class="p">))</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-497"></a>        <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">verts_src</span><span class="p">,</span> <span class="n">normals_src</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-498"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-499"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-500"></a>        <span class="c1"># Source list for the active UV map texture coords</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-501"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-502"></a>        <span class="n">uvlayer</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">uv_layers</span><span class="o">.</span><span class="n">active</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-503"></a>        <span class="k">if</span> <span class="n">uvlayer</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-504"></a>            <span class="n">tex_srcid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"-tex-"</span> <span class="o">+</span> <span class="n">uvlayer</span><span class="o">.</span><span class="n">name</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-505"></a>            <span class="n">tex_uv</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-506"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-507"></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">me</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-508"></a>                <span class="c1">#for loop_id in range(f.loop_start, f.loop_start + f.loop_total):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-509"></a>                <span class="k">for</span> <span class="n">loop_id</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">loop_indices</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-510"></a>                    <span class="n">tex_uv</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">uvlayer</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">loop_id</span><span class="p">]</span><span class="o">.</span><span class="n">uv</span><span class="p">])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-511"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-512"></a>            <span class="n">tex_uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tex_uv</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-513"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_values</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-514"></a>                <span class="n">tex_uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tex_uv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_decimals</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-515"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-516"></a>            <span class="n">tex_src</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">FloatSource</span><span class="p">(</span><span class="n">tex_srcid</span><span class="p">,</span> <span class="n">tex_uv</span><span class="p">,</span> <span class="p">(</span><span class="s1">'S'</span><span class="p">,</span> <span class="s1">'T'</span><span class="p">))</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-517"></a>            <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tex_src</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-518"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-519"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-520"></a>        <span class="c1"># Geometry node for this object incl. source lists</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-521"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-522"></a>        <span class="n">c_geom</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">+</span><span class="s2">"-geom"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">sources</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-523"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-524"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-525"></a>        <span class="c1"># Create Polylist for each material</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-526"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-527"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">matnode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">material_nodes</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-528"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-529"></a>            <span class="c1">#--- Input list to define data binding to the source lists</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-530"></a>            <span class="n">inlist</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">InputList</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-531"></a>            <span class="n">inlist</span><span class="o">.</span><span class="n">addInput</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'VERTEX'</span><span class="p">,</span> <span class="s1">'#'</span><span class="o">+</span><span class="n">verts_srcid</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-532"></a>            <span class="n">inlist</span><span class="o">.</span><span class="n">addInput</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'NORMAL'</span><span class="p">,</span> <span class="s1">'#'</span><span class="o">+</span><span class="n">normals_srcid</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-533"></a>            <span class="k">if</span> <span class="n">uvlayer</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-534"></a>                <span class="n">inlist</span><span class="o">.</span><span class="n">addInput</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'TEXCOORD'</span><span class="p">,</span> <span class="s1">'#'</span><span class="o">+</span><span class="n">tex_srcid</span><span class="p">,</span> <span class="nb">set</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-535"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-536"></a>            <span class="c1">#--- List of indicies to the source lists for each face f, for each vert v</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-537"></a>            <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-538"></a>            <span class="n">vcounts</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-539"></a>            <span class="n">n_id</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-540"></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">me</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-541"></a>                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">material_index</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-542"></a>                    <span class="n">vcounts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">vertices</span><span class="p">)])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-543"></a>                    <span class="k">for</span> <span class="n">v_id</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-544"></a>                        <span class="n">indices</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v_id</span><span class="p">,</span> <span class="n">n_id</span><span class="p">])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-545"></a>                        <span class="n">n_id</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-546"></a>                <span class="k">else</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-547"></a>                    <span class="k">for</span> <span class="n">v_id</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-548"></a>                        <span class="n">n_id</span> <span class="o">+=</span> <span class="mi">1</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-549"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-550"></a>            <span class="c1">#--- Bind polylist with existing material node</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-551"></a>            <span class="n">material_id</span> <span class="o">=</span> <span class="n">matnode</span><span class="o">.</span><span class="n">symbol</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-552"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-553"></a>            <span class="c1">#--- Append polylist to geometry</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-554"></a>            <span class="n">c_poly</span> <span class="o">=</span> <span class="n">c_geom</span><span class="o">.</span><span class="n">createPolylist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vcounts</span><span class="p">),</span> <span class="n">inlist</span><span class="p">,</span> <span class="n">material_id</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-555"></a>            <span class="n">c_geom</span><span class="o">.</span><span class="n">primitives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_poly</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-556"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-557"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-558"></a>        <span class="c1"># Create scene node for this object</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-559"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-560"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collada</span><span class="o">.</span><span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_geom</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-561"></a>        <span class="n">c_geom_node</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">GeometryNode</span><span class="p">(</span><span class="n">c_geom</span><span class="p">,</span> <span class="n">material_nodes</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-562"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-563"></a>        <span class="c1">#--- Object transformation matrix</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-564"></a>        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">matrix_world</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-565"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_values</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-566"></a>            <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_decimals</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-567"></a>        <span class="n">c_matrix</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">MatrixTransform</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-568"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-569"></a>        <span class="c1">#--- Scene node</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-570"></a>        <span class="n">c_node</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idname</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">c_matrix</span><span class="p">,</span> <span class="n">c_geom_node</span><span class="p">])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-571"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_node</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-572"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-573"></a>        <span class="c1">#--- Clean up mesh used for export</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-574"></a>        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-575"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-576"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-577"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-578"></a>    <span class="c1"># Sort XML nodes to fix Second Life upload</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-579"></a>    <span class="c1"># - With the default sorting, SL fails to upload textures</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-580"></a>    <span class="c1"># - newparam/surface node must be before newparam/sampler2D for each effect</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-581"></a>    <span class="c1">#---------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-582"></a>    <span class="k">def</span> <span class="nf">sortxml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-583"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-584"></a>        <span class="c1">#--- Load Collada XML file</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-585"></a>        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_path</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-586"></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-587"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-588"></a>        <span class="c1"># Collada namespace</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-589"></a>        <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'ns'</span><span class="p">:</span><span class="s1">'http://www.collada.org/2005/11/COLLADASchema'</span><span class="p">}</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-590"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-591"></a>        <span class="c1"># Get node tag without namespace</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-592"></a>        <span class="n">gettag</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">"{.*}"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-593"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-594"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-595"></a>        <span class="c1"># Re-order root nodes</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-596"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-597"></a>        <span class="n">root_order</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-598"></a>            <span class="s1">'asset'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-599"></a>            <span class="s1">'library_images'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-600"></a>            <span class="s1">'library_effects'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-601"></a>            <span class="s1">'library_materials'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-602"></a>            <span class="s1">'library_geometries'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-603"></a>            <span class="s1">'library_visual_scenes'</span><span class="p">,</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-604"></a>            <span class="s1">'scene'</span><span class="p">]</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-605"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-606"></a>        <span class="n">root</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">root</span> <span class="p">:</span> <span class="n">root_order</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">gettag</span><span class="p">(</span><span class="n">root</span><span class="p">)))</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-607"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-608"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-609"></a>        <span class="c1"># Reverse sort of effect nodes newparam/surface and newparam/sampler2D</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-610"></a>        <span class="c1">#-----------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-611"></a>        <span class="k">for</span> <span class="n">effect</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">'.//ns:effect/ns:profile_COMMON'</span><span class="p">,</span> <span class="n">ns</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-612"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-613"></a>            <span class="c1"># Find and remove newparam nodes from the tree</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-614"></a>            <span class="n">newparam</span> <span class="o">=</span> <span class="n">effect</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">"ns:newparam"</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-615"></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">newparam</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-616"></a>                <span class="n">effect</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-617"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-618"></a>            <span class="c1"># Insert sorted newparam nodes</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-619"></a>            <span class="c1"># &lt;surface&gt; node must be before &lt;sampler2D&gt;, thus reverse order</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-620"></a>            <span class="n">newparam</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">newparam</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">newparam</span> <span class="p">:</span> <span class="n">newparam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'sid'</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-621"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-622"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">newparam</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-623"></a>                <span class="n">effect</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">newparam</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-624"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-625"></a>        <span class="c1">#--- Write XML to file</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-626"></a>        <span class="n">spath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_path</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-627"></a>        <span class="c1">#tree.write(spath[0] +"_sortxml"+ spath[1])</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-628"></a>        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_path</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-629"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-630"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-631"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-632"></a><span class="c1"># MENU</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-633"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-634"></a><span class="k">def</span> <span class="nf">menu_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-635"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="n">ColladaExporter_OT</span><span class="o">.</span><span class="n">bl_idname</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">"Collada for SL (.dae)"</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-636"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-637"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-638"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-639"></a><span class="c1"># REGISTER/UNREGISTER ADDON CLASSES</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-640"></a><span class="c1">#-------------------------------------------------------------------------------</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-641"></a><span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-642"></a>    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_module</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-643"></a>    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">INFO_MT_file_export</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">menu_export</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-644"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-645"></a><span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-646"></a>    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unregister_module</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-647"></a>    <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">INFO_MT_file_export</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">menu_export</span><span class="p">)</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-648"></a>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-649"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
<a name="rest_code_257a9b819ea843148fc51ef6a7a931a6-650"></a>    <span class="n">register</span><span class="p">()</span>
</pre></td>
</tr></table>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/blender-addons/" rel="tag">blender-addons</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../toggle-object-wire/" rel="prev" title="Toggle Object Wire - Blender Addon"><i class="fa fa-arrow-left"></i>Â  Previous post</a>
            </li>
            <li class="next">
                <a href="../../rendering/nodes-correct-hdri/" rel="next" title="Correct Exposure of HDRI Environment Map in Blender">Next post Â <i class="fa fa-arrow-right"></i></a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="meshlogic",
            disqus_url="https://meshlogic.github.io/posts/blender/addons/collada-exporter-second-life/",
        disqus_title="Collada Exporter for Second Life - Blender Addon",
        disqus_identifier="cache/posts/blender/addons/collada-exporter-second-life.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="meshlogic";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
</div>


<!-- BODY FOOTER -->
<div class="container">
    <footer id="body_footer">

        
    Contents Â© 2018 by <a href="mailto:meshlogic@gmail.com">Miki</a>
    â Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
    

        

            
    <div class="counter">
        <script src="https://www.w3counter.com/tracker.js?id=103452"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82334406-1', 'auto');
            ga('send', 'pageview');
        </script>
</div>

    <div id="social_icons">
        <a href="https://github.com/meshlogic/" title="My GitHub"><i class="fa fa-3x fa-github"></i></a>

        <a href="https://www.flickr.com/people/meshlogic/" title="See my photos on Flickr!"><i class="fa fa-3x fa-flickr"></i></a>

        <a href="https://www.youtube.com/channel/UCJn5IgykaGERrwvzLhayJiw" title="See my videos on YouTube!"><i class="fa fa-3x fa-youtube-square"></i></a>
    </div>


    </footer>
</div>


<!-- SCRIPTS -->
            <script src="../../../../assets/js/all-nocdn.js"></script><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
</script>
</body>
</html>
